<!DOCTYPE html>
<html>
<head>
    <title>登录测试</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>VueCMF 登录测试</h1>
    <p>请按照以下步骤测试：</p>
    <ol>
        <li>清除浏览器缓存和localStorage</li>
        <li>访问 <a href="http://localhost:8081/#/login" target="_blank">http://localhost:8081/#/login</a></li>
        <li>使用用户名: vuecmf, 密码: 123456 登录</li>
        <li>登录成功后，尝试直接访问 <a href="http://localhost:8081/" target="_blank">http://localhost:8081/</a></li>
        <li>应该能正常进入后台</li>
        <li>然后清除localStorage中的token，再次访问 <a href="http://localhost:8081/" target="_blank">http://localhost:8081/</a></li>
        <li>应该会跳转到登录页面</li>
    </ol>
    
    <h2>测试结果</h2>
    <div id="result"></div>
    
    <script>
        // 测试token验证
        async function testTokenValidation() {
            const resultDiv = document.getElementById('result');
            
            // 测试无效token
            try {
                const response = await fetch('http://localhost:8082/vuecmf/admin/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'token': 'invalid_token'
                    },
                    body: 'action=index'
                });
                
                const result = await response.json();
                resultDiv.innerHTML += '<p>无效token测试: ' + JSON.stringify(result) + '</p>';
            } catch (error) {
                resultDiv.innerHTML += '<p>无效token测试错误: ' + error.message + '</p>';
            }
            
            // 测试有效token
            try {
                const response = await fetch('http://localhost:8082/vuecmf/admin/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: 'login_name=vuecmf&password=123456'
                });
                
                const result = await response.json();
                if (result.code === 0) {
                    const token = result.data.token;
                    resultDiv.innerHTML += '<p>登录成功，token: ' + token.substring(0, 10) + '...</p>';
                    
                    // 测试有效token
                    const validResponse = await fetch('http://localhost:8082/vuecmf/admin/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                            'token': token
                        },
                        body: 'action=index'
                    });
                    
                    const validResult = await validResponse.json();
                    resultDiv.innerHTML += '<p>有效token测试: ' + JSON.stringify(validResult) + '</p>';
                } else {
                    resultDiv.innerHTML += '<p>登录失败: ' + result.msg + '</p>';
                }
            } catch (error) {
                resultDiv.innerHTML += '<p>有效token测试错误: ' + error.message + '</p>';
            }
        }
        
        // 页面加载时执行测试
        window.onload = testTokenValidation;
    </script>
</body>
</html> 